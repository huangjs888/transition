import t from"react";import e from"react-dom";const s=/^(?:-border(?:-top|-right|-bottom|-left)?(?:-width|)|(?:-margin|-padding)?(?:-top|-right|-bottom|-left)?|(?:-min|-max)?(?:-width|-height))$/;const i=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement)?t.useLayoutEffect:t.useEffect;function n(){return n=Object.assign?Object.assign.bind():function(t){for(var e=1;arguments.length>e;e++){var s=arguments[e];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t},n.apply(this,arguments)}function o(t,e){if(null==t)return{};var s,i,n={},o=Object.keys(t);for(i=0;o.length>i;i++)0>e.indexOf(s=o[i])&&(n[s]=t[s]);return n}const a="undefined"==typeof window?global:window,r=["moz","webkit"];let c=a.requestAnimationFrame,l=a.cancelAnimationFrame||a.cancelRequestAnimationFrame;if(!c||!l)for(var h=0;2>h;h++)c=a[r[h]+"RequestAnimationFrame"],l=a[r[h]+"CancelAnimationFrame"]||a[r[h]+"CancelRequestAnimationFrame"];c&&l||(c=function(){let t=0;return function(e){const s=Date.now(),i=Math.max(0,16-(s-t));return t=s+i,window.setTimeout(e,i)}}(),l=function(t){return window.clearTimeout(t)});const u=c,d=l,f=(t,e)=>e>0?+setTimeout(t,e):(t(Math.abs(e)),0);class p{constructor({duration:t,easing:e,delay:s}={}){this._delay=0,this._frameId=0,this._elapsed=0,this._sleepId=0,this._delayId=0,this._tick=null,this._delayFn=null,this.duration="number"==typeof t&&t>0?t:0,this.easing="function"!=typeof e?t=>t:e,this.delay="number"!=typeof s?0:s}start(t){if(!this._tick&&!this._delayFn){const{duration:e,easing:s,delay:i}=this;this._delayFn=i=>{if(this._delayId=0,this._delayFn=null,this._delay=0,e>0){const n=i=>{const o=Date.now();this._elapsed+=o-i,e>this._elapsed?(this._frameId=u((()=>n(o))),t(s(this._elapsed/e))):(this._tick=null,this._frameId=0,this._elapsed=0,t(1))};this._tick=n,this._elapsed=i||0,n(Date.now())}else t(1)},this._delay=Date.now(),this._delayId=f(this._delayFn,i)}}restart(){if((this._tick||this._delayFn)&&(this.stop(),this._tick&&this._tick(Date.now()),this._delayFn)){const t=this.delay+this._delay;this._delay+=Date.now(),this._delayId=f(this._delayFn,t)}}sleep(t){t&&t>0&&(this._tick||this._delayFn)&&(this.stop(),this._sleepId=+setTimeout((()=>{this._sleepId=0,this.restart()}),t))}stop(){(this._tick||this._delayFn)&&(this._delayId&&(clearTimeout(this._delayId),this._delayId=0,this._delay-=Date.now()),this._frameId&&(d(this._frameId),this._frameId=0),this._sleepId&&(clearTimeout(this._sleepId),this._sleepId=0))}end(){(this._tick||this._delayFn)&&(this.stop(),this._tick&&this._tick(Date.now()+this._elapsed-this.duration),this._delayFn&&this._delayFn(this.duration))}}let _=class{constructor(t,e,s){const i=this.value="number"==typeof t?{default:t}:t;if("number"==typeof e){const t={};Object.keys(i).forEach((s=>{t[s]=e||0})),this.precision=t}else e&&(this.precision=e);"function"==typeof s&&(this.transform=s)}toRaw(){const t={value:this.value};return this.precision&&(t.precision=this.precision),this.transform&&(t.transform=this.transform),t}};const m=["value","precision"];const y=["value"],v=["before","after","cancel"];class w{constructor({cssProperties:t,apply:e}={}){this.cssProperties={},this._cssProperties=null,this._animations=[],this._apply=e||(()=>{}),t&&this.apply(t)}update(){!this.running()&&this._cssProperties&&(this.cssProperties=this._cssProperties,this._cssProperties=null);const{cssProperties:t}=this,e={};Object.keys(t).forEach((s=>{const{value:i,transform:n}=t[s];e[s.replace(/([A-Z])/g,"-$1").toLocaleLowerCase()]=n(i)})),this._apply(e)}value(){const t=this._cssProperties||this.cssProperties,e={};return Object.keys(t).forEach((s=>{e[s]=t[s].value})),e}apply(t,e){this._cssProperties||(this._cssProperties=this.cssProperties);const s=function(t,e){const s=n({},t);if(e instanceof _){const i=Object.keys(t)[0];if(i){const o=t[i],a=e.toRaw();s[i]=n({},o,a,{value:n({},o.value,a.value)})}}else Object.keys(e).forEach((i=>{const o=t[i],a=e[i].toRaw();s[i]=o?n({},o,a,{value:n({},o.value,a.value)}):n({transform:t=>Object.keys(t).map((e=>t[e])).join(" "),precision:{}},a)}));return s}(this._cssProperties,t),i=function(t,e){const s={};return Object.keys(t).forEach((i=>{const a=t[i].value,r=e[i],{value:c,precision:l}=r,h=o(r,m);let u=null;Object.keys(a).forEach((t=>{const e=c[t]-a[t];Math.abs(e)>(l[t]||0)&&(u||(u={}),u[t]=e)})),u&&(s[i]=n({value:u,precision:l},h))})),s}(this._cssProperties,s);this._cssProperties=s;const a=Object.keys(i),r={};a.forEach((t=>{const e=i[t],{value:s}=e,a=o(e,y);r[t]=n({value:n({},s)},a),this.cssProperties[t]=n({},this.cssProperties[t],a)}));const c=e&&0!==a.length?e:{};return new Promise((t=>{const{before:e=(()=>{}),after:s=(()=>{}),cancel:n=!0}=c,l=o(c,v),h=new p(l);this._animations.push({animation:h,cancel:n,remain:r}),h.start((n=>{const o=e(n,this.value());if(!1!==o){let t=n;"number"==typeof o&&(t=o),a.forEach((e=>{const s=this.cssProperties[e].value,n=i[e].value,o=r[e].value;Object.keys(n).forEach((e=>{const i=n[e]*(1-t);s[e]+=o[e]-i,o[e]=i}))})),this.update()}if(s(n,this.value()),1===n){const e=this._animations.findIndex((t=>h===t.animation));-1!==e&&this._animations.splice(e,1),this.update(),t(this.value())}}))}))}cancel(t=!1){let e=0;return this._animations=this._animations.filter((({animation:s,remain:i,cancel:n})=>{if(n){s[t?"end":"stop"](),e+=1;const n=this._cssProperties;return n&&Object.keys(i).forEach((t=>{if(n[t]){const e=i[t].value,s=n[t].value;Object.keys(e).forEach((t=>{s[t]-=e[t]}))}})),!1}return!0})),this.update(),e}running(){return 0!==this._animations.length}}const b=_;var k=t.forwardRef((({children:n,launch:o,cancel:a},r)=>{const c=t.useRef(null),l=t.useRef(null);i((()=>{l.current=new w({apply:t=>{const e=c.current;e instanceof Element||console.warn("Warning: Transition children is not dom."),function(t,e){if(t&&e){let i="";Object.keys(e).forEach((n=>{const o=function(t){return t.replace(/([A-Z])/g,"-$1").toLocaleLowerCase()}(n),a=e[n];if(a||0===a){const t="number"==typeof a&&/^[a-z]/.test(o)&&s.test("-"+o)?"px":"";i+=`${o}: ${a}${t};`}else t.style.removeProperty(o)})),t.style.cssText+=i}}(e,t)}})}),[]),i((()=>{if(o&&l.current){const{cssProperties:t,extendOptions:e,transitionEnd:s=(()=>{})}=o;t&&l.current.apply(t,e).then(s)}}),[o]),i((()=>{if(a&&l.current){const t=l.current.cancel(!0!==a&&a.end);!0!==a&&"function"==typeof a.count&&a.count(t)}}),[a]),t.useImperativeHandle(r,(()=>({findDOMElement:()=>c.current,getInstance:()=>l.current})),[]);const h=t.useCallback((s=>{let i=s;!(s instanceof Element)&&s instanceof t.Component&&(i=e.findDOMNode(s)),i instanceof Element||(i=null),c.current=i}),[]);return n?t.Children.only(t.cloneElement(n,{ref:h})):(console.warn("Warning: Transition children must exist."),null)}));export{b as Value,k as default};
//# sourceMappingURL=react-transition.min.js.map
