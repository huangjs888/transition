{"version":3,"file":"react-transition.min.js","sources":["../node_modules/@huangjs888/lightdom/es/lightdom.min.js","../src/react/useIsomorphicLayoutEffect.ts","../src/animation/raf.ts","../src/animation/index.ts","../src/core/value.ts","../src/core/index.ts","../src/core/method.ts","../src/react/index.tsx"],"sourcesContent":["let e;function t(t){if(\"undefined\"==typeof document)return 0;if(t||void 0===e){const t=document.createElement(\"div\");t.style.width=\"100%\",t.style.height=\"200px\";const n=document.createElement(\"div\"),o=n.style;o.position=\"absolute\",o.top=\"0\",o.left=\"0\",o.pointerEvents=\"none\",o.visibility=\"hidden\",o.width=\"200px\",o.height=\"150px\",o.overflow=\"hidden\",n.appendChild(t),document.body.appendChild(n);const i=t.offsetWidth;n.style.overflow=\"scroll\";let r=t.offsetWidth;i===r&&(r=n.clientWidth),document.body.removeChild(n),e=i-r}return e}function n(e){const n=e.match(/^(.*)px$/),o=Number(null==n?void 0:n[1]);return Number.isNaN(o)?t():o}function o(e){return e.replace(/([A-Z])/g,\"-$1\").toLocaleLowerCase()}function i(e){return e.replace(/-(.?)/g,(e=>e.replace(\"-\",\"\").toLocaleUpperCase()))}function r(e){if(\"boolean\"==typeof e){const n=t(e);return{width:n,height:n}}if(!(\"undefined\"!=typeof document&&e&&e instanceof Element))return{width:0,height:0};const{width:o,height:i}=getComputedStyle(e,\"::-webkit-scrollbar\");return{width:n(o),height:n(i)}}function c(){return document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight)&&window.innerWidth>document.body.offsetWidth}function d(e,t){let n=document.querySelector(\"#\"+e);n||(n=document.createElement(\"style\"),n.id=e,n.appendChild(document.createTextNode(t)),(document.head||document.getElementsByTagName(\"head\")[0]).appendChild(n))}const l=/^(?:-border(?:-top|-right|-bottom|-left)?(?:-width|)|(?:-margin|-padding)?(?:-top|-right|-bottom|-left)?|(?:-min|-max)?(?:-width|-height))$/;function s(e,t){if(e&&t){let n=\"\";Object.keys(t).forEach((i=>{const r=o(i),c=t[i];if(c||0===c){const e=\"number\"==typeof c&&/^[a-z]/.test(r)&&l.test(\"-\"+r)?\"px\":\"\";n+=`${r}: ${c}${e};`}else e.style.removeProperty(r)})),e.style.cssText+=n}return e}function u(e,t){return!(!e||!t)&&e.classList.contains(t)}function a(e,t){return e&&t&&(Array.isArray(t)?t:t.split(\" \")).forEach((t=>t&&e.classList.add(t))),e}function h(e,t){return e&&t&&(Array.isArray(t)?t:t.split(\" \")).forEach((t=>t&&e.classList.remove(t))),e}function f(e){let t=e;return\"string\"==typeof e&&(t=document.querySelector(e)),\"function\"==typeof e&&(t=e()),t||null}function m(e,t,n,i){var r;let c,d,l,u;\"string\"==typeof e?(c=e,d=t||{},l=Array.isArray(n)?n:[n],u=i):(c=\"div\",d=e||{},l=Array.isArray(t)?t:[t],u=n);const h=s(a(document.createElement(c),d.className),d.style),m=d.attrs||{};return Object.keys(m).forEach((e=>{const t=o(e);\"innerHTML\"!==e&&\"className\"!==e&&\"style\"!==e&&t in h&&(h[t]=m[e])})),l.forEach((e=>{e instanceof Element?null==h||h.appendChild(e):h&&null!=e&&(h.innerHTML=e+\"\")})),null==(r=f(u))||r.appendChild(h),h}export{a as addClass,m as createElement,d as cssInject,f as getElement,r as getScrollBarSize,u as hasClass,o as humpToHyphen,i as hyphenToHump,c as isBodyOverflowing,h as removeClass,s as setStyle};\n//# sourceMappingURL=lightdom.min.js.map\n","/*\n * @Author: Huangjs\n * @Date: 2023-08-24 16:40:36\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-08-31 11:28:10\n * @Description: ******\n */\n\nimport React from 'react';\n\nexport const canUseDOM = !!(\n  typeof window !== 'undefined' &&\n  typeof window.document !== 'undefined' &&\n  typeof window.document.createElement !== 'undefined'\n);\n\nexport const useIsomorphicLayoutEffect = canUseDOM ? React.useLayoutEffect : React.useEffect;\n","/*\n * @Author: Huangjs\n * @Date: 2023-08-23 17:02:10\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-09-01 15:18:11\n * @Description: ******\n */\n\nconst root: any = typeof window === 'undefined' ? global : window;\nconst vendors = ['moz', 'webkit'];\nlet raf = root.requestAnimationFrame;\nlet caf = root.cancelAnimationFrame || root.cancelRequestAnimationFrame;\nif (!raf || !caf) {\n  for (var i = 0; i < vendors.length; i++) {\n    raf = root[`${vendors[i]}RequestAnimationFrame`];\n    caf =\n      root[`${vendors[i]}CancelAnimationFrame`] || root[`${vendors[i]}CancelRequestAnimationFrame`];\n  }\n}\nif (!raf || !caf) {\n  raf = (function () {\n    let last = 0;\n    // setTimeout时间并不精确，这里做了校准\n    return function (fn: () => void) {\n      const now = Date.now();\n      const delay = Math.max(0, 16 - (now - last));\n      last = now + delay;\n      return window.setTimeout(fn, delay);\n    };\n  })();\n  caf = function (id: number) {\n    return window.clearTimeout(id);\n  };\n}\n\nexport const requestAnimationFrame = raf;\nexport const cancelAnimationFrame = caf;\n","/*\n * @Author: Huangjs\n * @Date: 2023-02-13 15:22:58\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-10-10 14:24:45\n * @Description: ******\n */\n\nimport { requestAnimationFrame, cancelAnimationFrame } from './raf';\n\nconst delayCall = (callback: IAnimationCallBack, delay: number) => {\n  if (delay > 0) {\n    return +setTimeout(callback, delay);\n  }\n  callback(Math.abs(delay));\n  return 0;\n};\n\nclass Animation {\n  duration: number; // 动画执行持续时间\n  easing: IAnimationEasing; // 动画执行时变换函数\n  delay: number; // 动画延迟多久执行\n  _delay: number = 0; // 延迟执行剩余delay时间\n  _frameId: number = 0; // 当前正在执行帧的id\n  _elapsed: number = 0; // 本次动画已经消耗的时间\n  _sleepId: number = 0; // 当前正在休眠计时id\n  _delayId: number = 0; // 当前delay计时id\n  _tick: IAnimationCallBack | null = null; // 每一帧动画执行函数\n  _delayFn: IAnimationCallBack | null = null; // 延迟执行需要执行的函数\n  constructor({ duration, easing, delay }: IAnimationOptions = {}) {\n    this.duration = typeof duration !== 'number' || duration <= 0 ? 0 : duration;\n    this.easing = typeof easing !== 'function' ? (v) => v : easing;\n    this.delay = typeof delay !== 'number' ? 0 : delay;\n  }\n  start(frameFn: IAnimationCallBack) {\n    // 只有从未开始过或着已经结束了的动画可以再开始\n    if (!this._tick && !this._delayFn) {\n      const { duration, easing, delay } = this;\n      this._delayFn = (elapsed) => {\n        this._delayId = 0;\n        this._delayFn = null;\n        this._delay = 0;\n        if (duration > 0) {\n          const tick: IAnimationCallBack = (last) => {\n            // 本帧时间戳，last：上一帧时间戳\n            const now = Date.now();\n            // 累计已经耗用的时间\n            this._elapsed += now - last;\n            if (this._elapsed < duration) {\n              // 开启下一帧\n              this._frameId = requestAnimationFrame(() => tick(now));\n              // 每一帧的进度\n              frameFn(easing(this._elapsed / duration));\n            } else {\n              // 执行完毕后清除\n              this._tick = null;\n              this._frameId = 0;\n              this._elapsed = 0;\n              frameFn(1);\n            }\n          };\n          this._tick = tick;\n          // 第一次直接用掉这些时间\n          this._elapsed = elapsed || 0;\n          tick(Date.now());\n        } else {\n          // duration为0，直接运行到最后\n          frameFn(1);\n        }\n      };\n      // 记录延迟开始时间戳\n      this._delay = Date.now();\n      // 延迟执行\n      this._delayId = delayCall(this._delayFn, delay);\n    }\n  }\n  restart() {\n    if (this._tick || this._delayFn) {\n      // 只有动画在延迟、动画、休眠，停止的时候可以restart\n      // 重启之前先停止一切\n      this.stop();\n      if (this._tick) {\n        // 动画、休眠，停止状态，停止后，启动帧继续运行\n        this._tick(Date.now());\n      }\n      if (this._delayFn) {\n        const delay = this.delay + this._delay;\n        // 更新时间戳\n        this._delay += Date.now();\n        // 延迟状态，停止后，开启新的延迟\n        this._delayId = delayCall(this._delayFn, delay);\n      }\n    }\n  }\n  sleep(time: number) {\n    if (!time || time <= 0) {\n      // 没有设置休眠时间，则不做任何操作\n      return;\n    }\n    if (this._tick || this._delayFn) {\n      // 只有动画在延迟、动画、休眠，停止的时候可以进行休眠\n      // 这里注意，停止状态的时候点休眠，相当于延迟restart，时间一到会重启动画\n      // sleep之前先停止一切\n      this.stop();\n      // 启动本次休眠\n      this._sleepId = +setTimeout(() => {\n        this._sleepId = 0;\n        // 到时间后重启动画\n        this.restart();\n      }, time);\n    }\n  }\n  stop() {\n    if (this._tick || this._delayFn) {\n      if (this._delayId) {\n        // 如果正在delay，则停止delay\n        clearTimeout(this._delayId);\n        this._delayId = 0;\n        // 停止延迟时，已耗用时间\n        this._delay -= Date.now();\n      }\n      if (this._frameId) {\n        // 如果正在运行，即正在动画，则停止动画\n        cancelAnimationFrame(this._frameId);\n        this._frameId = 0;\n      }\n      if (this._sleepId) {\n        // 如果正在sleep，则停止sleep\n        clearTimeout(this._sleepId);\n        this._sleepId = 0;\n      }\n    }\n  }\n  end() {\n    if (this._tick || this._delayFn) {\n      // 只有动画在延迟、动画、休眠，停止的时候可以直接end\n      // end之前先停止一切\n      this.stop();\n      if (this._tick) {\n        // 动画、休眠，停止状态，停止后，启动帧运行到最后\n        this._tick(Date.now() + this._elapsed - this.duration);\n      }\n      if (this._delayFn) {\n        // 延迟状态，停止后，直接运行到最后\n        this._delayFn(this.duration);\n      }\n    }\n  }\n}\n\ntype IAnimationCallBack = (v: number) => void;\n\nexport type IAnimationEasing = (v: number) => number;\n\nexport type IAnimationOptions = {\n  duration?: number; // 动画持续时间\n  easing?: IAnimationEasing; // 动画变换函数\n  delay?: number; // 动画延迟多久执行，负数的话，会在第一次把这个时间内的变化一次性用掉，具体看css3-transition-delay\n};\n\nexport { requestAnimationFrame, cancelAnimationFrame };\n\nexport default Animation;\n","/*\n * @Author: Huangjs\n * @Date: 2023-02-13 15:22:58\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-09-06 15:57:42\n * @Description: ******\n */\n\nimport { type ICSSValue } from './index';\n\nexport default class Value {\n  value: ICSSValue; // 传入css属性值，对象或值的形式\n  precision?: ICSSValue; // 传入精度，与value对应\n  transform?: (v: ICSSValue) => string; // 传入实现该value转变为style的字符串方法\n  constructor(\n    value: number | ICSSValue,\n    precision?: number | ICSSValue,\n    transform?: (v: ICSSValue) => string,\n  ) {\n    const _value = (this.value = typeof value === 'number' ? { default: value } : value);\n    if (typeof precision === 'number') {\n      const _precision: ICSSValue = {};\n      Object.keys(_value).forEach((k) => {\n        _precision[k] = precision || 0;\n      });\n      this.precision = _precision;\n    } else if (precision) {\n      this.precision = precision;\n    }\n    if (typeof transform === 'function') {\n      this.transform = transform;\n    }\n  }\n  toRaw() {\n    const raw: {\n      value: ICSSValue;\n      precision?: ICSSValue;\n      transform?: (v: ICSSValue) => string;\n    } = { value: this.value };\n    if (this.precision) {\n      raw.precision = this.precision;\n    }\n    if (this.transform) {\n      raw.transform = this.transform;\n    }\n    return raw;\n  }\n}\n","/*\n * @Author: Huangjs\n * @Date: 2023-02-13 15:22:58\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-10-10 14:14:42\n * @Description: ******\n */\n\nimport Animation, { type IAnimationOptions } from '../animation';\nimport ICSSOptionValue from './value';\nimport { union, delta } from './method';\n\nclass Transition {\n  cssProperties: ICSSProperties = {}; // 元素的css属性信息，和元素实际css结果保持同步\n  _cssProperties: ICSSProperties | null = null; // 每次动画开启前缓存的css信息，不会和元素实际css结果保持同步，是执行动画后的最终结果\n  _animations: {\n    animation: Animation; // 当前正在执行的过渡动画\n    remain: ICSSProperties; // 剩余未执行的值\n    cancel: boolean; // 该过渡动画是否可以停止\n  }[] = []; // 该属性执行所有过渡的动画集合\n  _apply: (style: ICSSStyle) => void;\n  constructor({ cssProperties, apply }: ITransitionOptions = {}) {\n    this._apply = apply || (() => {});\n    if (cssProperties) {\n      this.apply(cssProperties);\n    }\n  }\n  update() {\n    // 动画全部结束后将当前值更新为最终缓存值\n    if (!this.running() && this._cssProperties) {\n      this.cssProperties = this._cssProperties;\n      this._cssProperties = null;\n    }\n    // 更新样式\n    const { cssProperties } = this;\n    const style: ICSSStyle = {};\n    Object.keys(cssProperties).forEach((name) => {\n      const { value, transform } = cssProperties[name];\n      // 将驼峰转换为 - 连字符，style.setProperty只支持 - 连字符，不支持驼峰（不生效）\n      style[name.replace(/([A-Z])/g, '-$1').toLocaleLowerCase()] = transform(value);\n    });\n    this._apply(style);\n  }\n  value() {\n    // 正在动画的时候取_cssProperties\n    const cssProperties = this._cssProperties || this.cssProperties;\n    const value: ICSSLikeStyle = {};\n    Object.keys(cssProperties).forEach((k) => {\n      value[k] = cssProperties[k].value;\n    });\n    return value;\n  }\n  apply(cssProperties: ICSSOptionProperties, extendOptions?: IAnimationExtendOptions) {\n    if (!this._cssProperties) {\n      // 初始没有缓存值的情况，取当前值\n      this._cssProperties = this.cssProperties;\n    }\n    // 修正合并\n    const unionCSSProperties = union(this._cssProperties, cssProperties);\n    // 计算出动画需要的增量\n    const deltaCSSProperties = delta(this._cssProperties, unionCSSProperties);\n    // 缓存动画最终值\n    this._cssProperties = unionCSSProperties;\n    // 动画增量的键集合\n    const deltaCSSNames = Object.keys(deltaCSSProperties);\n    // 存储每一帧动画后还有多少剩余没有执行\n    const remainCSSProperties: ICSSProperties = {};\n    // 初始的时候是全部值\n    deltaCSSNames.forEach((name) => {\n      const { value, ...restItem } = deltaCSSProperties[name];\n      remainCSSProperties[name] = {\n        value: { ...value },\n        ...restItem,\n      };\n      // 更新除了value之外的其它值\n      this.cssProperties[name] = {\n        ...this.cssProperties[name],\n        ...restItem,\n      };\n    });\n    // 如果没有传入extendOptions或者没有需要执行动画的增量，则无动画配置（动画会默认duration为0，按进度100%一次执行完毕）\n    const _extendOptions = !extendOptions || deltaCSSNames.length === 0 ? {} : extendOptions;\n    return new Promise<ICSSLikeStyle>((resolve) => {\n      const { before = () => {}, after = () => {}, cancel = true, ...restOptions } = _extendOptions;\n      const animation = new Animation(restOptions);\n      this._animations.push({ animation, cancel, remain: remainCSSProperties });\n      // 开启动画\n      animation.start((progress) => {\n        const next = before(progress, this.value());\n        if (next !== false) {\n          let _progress = progress;\n          if (typeof next === 'number') {\n            _progress = next;\n          }\n          deltaCSSNames.forEach((name) => {\n            const thisCSSValue = this.cssProperties[name].value;\n            const deltaCSSValue = deltaCSSProperties[name].value;\n            const remainCSSValue = remainCSSProperties[name].value;\n            Object.keys(deltaCSSValue).forEach((key) => {\n              // 总的需要消费数减去已经消费的部分，即为这一帧之后未消费的部分，_progress为已消费的进度\n              const remainValue = deltaCSSValue[key] * (1 - _progress);\n              // 上一帧未消费的部分减去这一帧之后未消费的部分，即为本次需要消费的部分\n              thisCSSValue[key] += remainCSSValue[key] - remainValue;\n              // 更新最新剩余未消费的\n              remainCSSValue[key] = remainValue;\n            });\n          });\n          this.update();\n        }\n        after(progress, this.value());\n        if (progress === 1) {\n          // 动画结束后删除集合中的这个动画对象\n          const index = this._animations.findIndex((a) => animation === a.animation);\n          // 一般情况不出出现-1，这里强判断（防止动画出现了两次progress为1的情况）\n          if (index !== -1) {\n            this._animations.splice(index, 1);\n          }\n          this.update();\n          resolve(this.value());\n        }\n      });\n    });\n  }\n  cancel(end: boolean = false) {\n    // end是告诉动画取消时是停留在当前还是执行到终点\n    let count = 0;\n    this._animations = this._animations.filter(({ animation, remain, cancel }) => {\n      if (cancel) {\n        animation[end ? 'end' : 'stop']();\n        count += 1;\n        // 动画停止后，_cssProperties里面必须把停止的动画未完成的部分减掉\n        const _cssProperties = this._cssProperties;\n        if (_cssProperties) {\n          Object.keys(remain).forEach((name) => {\n            if (_cssProperties[name]) {\n              const remainCSSValue = remain[name].value;\n              const tempCSSValue = _cssProperties[name].value;\n              Object.keys(remainCSSValue).forEach((key) => {\n                tempCSSValue[key] -= remainCSSValue[key];\n              });\n            }\n          });\n        }\n        return false;\n      }\n      return true;\n    });\n    this.update();\n    return count;\n  }\n  running() {\n    return this._animations.length !== 0;\n  }\n}\n\nexport type ICSSName = string;\n\nexport type ICSSValue = {\n  [key: string]: number;\n};\n\nexport type ICSSStyle = {\n  [key: ICSSName]: string;\n};\n\nexport type ICSSLikeStyle = {\n  [key: ICSSName]: ICSSValue;\n};\n\nexport type ICSSProperties = {\n  [key: ICSSName]: {\n    value: ICSSValue; // 传入css属性值，对象或值的形式\n    precision: ICSSValue; // 传入精度，与value对应\n    transform: (v: ICSSValue) => string; // 传入实现该value转变为style的字符串方法\n  };\n};\n\nexport type IAnimationExtendOptions = IAnimationOptions & {\n  cancel?: boolean; // 该过渡过程是否可以取消\n  // 过渡时每一帧执行之前（只针对过渡动画，对于精度值小于precision的变化，由于不会开启Animation，所以不会调用该函数）\n  // 返回false，则该帧不执行即丢帧，返回其它则按照原来的继续向下执行（若返回是数字，则会达到篡改progress目的）\n  before?: (p: number, v?: ICSSLikeStyle) => void | boolean | number;\n  // 过渡时每一帧执行之后（只针对过渡动画，对于精度值小于precision的变化，由于不会开启Animation，所以不会调用该函数）\n  after?: (p: number, v?: ICSSLikeStyle) => void;\n};\n\nexport type ICSSOptionProperties =\n  | ICSSOptionValue\n  | {\n      [key: ICSSName]: ICSSOptionValue;\n    };\n\nexport type ITransitionOptions = {\n  cssProperties?: ICSSOptionProperties; // 过渡的css属性信息\n  apply?: (style: ICSSStyle) => void;\n};\n\nexport const Value = ICSSOptionValue;\n\nexport default Transition;\n","/*\n * @Author: Huangjs\n * @Date: 2023-02-13 15:22:58\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-09-04 14:42:32\n * @Description: ******\n */\n\nimport Value from './value';\nimport { type ICSSValue, type ICSSProperties, type ICSSOptionProperties } from '.';\n\nexport function delta(\n  startCSSProperties: ICSSProperties,\n  endCSSProperties: ICSSProperties,\n): ICSSProperties {\n  const finalCSSProperties: ICSSProperties = {};\n  Object.keys(startCSSProperties).forEach((name) => {\n    const startCSSValue = startCSSProperties[name].value;\n    const { value: endCSSValue, precision, ...restItem } = endCSSProperties[name];\n    let deltaCSSValue: ICSSValue | null = null;\n    Object.keys(startCSSValue).forEach((key) => {\n      const deltaValue = endCSSValue[key] - startCSSValue[key];\n      if (Math.abs(deltaValue) > (precision[key] || 0)) {\n        if (!deltaCSSValue) {\n          deltaCSSValue = {};\n        }\n        deltaCSSValue[key] = deltaValue;\n      }\n    });\n    if (deltaCSSValue) {\n      finalCSSProperties[name] = { value: deltaCSSValue, precision, ...restItem };\n    }\n  });\n  return finalCSSProperties;\n}\nexport function union(\n  oldCSSProperties: ICSSProperties,\n  newCSSProperties: ICSSOptionProperties,\n): ICSSProperties {\n  const finalCSSProperties: ICSSProperties = {\n    ...oldCSSProperties,\n  };\n  if (newCSSProperties instanceof Value) {\n    const oldCSSName = Object.keys(oldCSSProperties)[0];\n    if (oldCSSName) {\n      const oldCSSValue = oldCSSProperties[oldCSSName];\n      const newCSSValue = newCSSProperties.toRaw();\n      finalCSSProperties[oldCSSName] = {\n        ...oldCSSValue,\n        ...newCSSValue,\n        value: {\n          ...oldCSSValue.value,\n          ...newCSSValue.value,\n        },\n      };\n    }\n  } else {\n    Object.keys(newCSSProperties).forEach((name) => {\n      const oldCSSValue = oldCSSProperties[name];\n      const newCSSValue = newCSSProperties[name].toRaw();\n      if (oldCSSValue) {\n        finalCSSProperties[name] = {\n          ...oldCSSValue,\n          ...newCSSValue,\n          value: {\n            ...oldCSSValue.value,\n            ...newCSSValue.value,\n          },\n        };\n      } else {\n        finalCSSProperties[name] = {\n          transform: (v) =>\n            Object.keys(v)\n              .map((k) => v[k])\n              .join(' '),\n          precision: {},\n          ...newCSSValue,\n        };\n      }\n    });\n  }\n  return finalCSSProperties;\n}\n","/*\n * @Author: Huangjs\n * @Date: 2023-08-22 16:15:47\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-10-10 14:15:47\n * @Description: ******\n */\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { setStyle } from '@huangjs888/lightdom';\nimport { useIsomorphicLayoutEffect } from './useIsomorphicLayoutEffect';\nimport Core, {\n  type ICSSLikeStyle,\n  type ICSSOptionProperties,\n  type IAnimationExtendOptions,\n} from '../core';\n\nexport * from '../core';\n\nexport type ILaunch = {\n  cssProperties?: ICSSOptionProperties;\n  extendOptions?: IAnimationExtendOptions;\n  transitionEnd?: (v: ICSSLikeStyle) => void;\n};\nexport type ICancel = boolean | { end?: boolean; count?: (v: number) => void };\n\nexport type ITransitionRef = {\n  findDOMElement: () => Element | null | undefined;\n  getInstance: () => Core | null | undefined;\n};\n\nexport type ITransitionProps = {\n  launch?: ILaunch;\n  cancel?: ICancel;\n  children?: React.ReactNode;\n};\n\nexport default React.forwardRef<ITransitionRef, ITransitionProps>(\n  ({ children, launch, cancel }, ref) => {\n    const elementRef = React.useRef<Element | null>(null);\n    const coreRef = React.useRef<Core | null>(null);\n\n    useIsomorphicLayoutEffect(() => {\n      coreRef.current = new Core({\n        apply: (style) => {\n          const el = elementRef.current;\n          if (!(el instanceof Element)) {\n            console.warn(`Warning: Transition children is not dom.`);\n          }\n          setStyle(el, style);\n          // 也可以使用setState\n        },\n      });\n    }, []);\n\n    useIsomorphicLayoutEffect(() => {\n      if (launch && coreRef.current) {\n        const { cssProperties, extendOptions, transitionEnd = () => {} } = launch;\n        cssProperties && coreRef.current.apply(cssProperties, extendOptions).then(transitionEnd);\n      }\n    }, [launch]);\n\n    useIsomorphicLayoutEffect(() => {\n      if (cancel && coreRef.current) {\n        const count = coreRef.current.cancel(cancel === true ? false : cancel.end);\n        if (cancel !== true) {\n          typeof cancel.count === 'function' && cancel.count(count);\n        }\n      }\n    }, [cancel]);\n\n    React.useImperativeHandle(\n      ref,\n      (): ITransitionRef => ({\n        findDOMElement: () => elementRef.current,\n        getInstance: () => coreRef.current,\n      }),\n      [],\n    );\n\n    // 这里ref函数使用useCallback，为了使每次渲染ref函数为同一个函数\n    // 如果函数直接写在下面的ref里，如下所示，则箭头函数在每次渲染都相当于重新创建\n    // 此时react里会比较发现ref函数变化，就会先执行变化前的函数，传入null，再执行变化后的函数，传入实际值\n    // React.cloneElement(children, {\n    //   ref: (a)=>{\n    //     ...\n    //   },\n    // })\n    const refFun = React.useCallback((_ref: React.ReactInstance) => {\n      let element: any = _ref;\n      // ref是Element的时候不需要查找，只有是React.Component的时候才可以查找\n      if (!(_ref instanceof Element) && _ref instanceof React.Component) {\n        element = ReactDOM.findDOMNode(_ref);\n      }\n      if (!(element instanceof Element)) {\n        element = null;\n      }\n      elementRef.current = element;\n    }, []);\n\n    if (!children) {\n      console.warn('Warning: Transition children must exist.');\n      return null;\n    }\n\n    return React.Children.only(\n      React.cloneElement(children as any, {\n        ref: refFun,\n      }),\n    );\n  },\n);\n"],"names":["l","useIsomorphicLayoutEffect","window","document","createElement","React","useLayoutEffect","useEffect","root","global","vendors","raf","requestAnimationFrame","caf","cancelAnimationFrame","cancelRequestAnimationFrame","i","last","fn","now","Date","delay","Math","max","setTimeout","id","clearTimeout","delayCall","callback","abs","Animation","constructor","duration","easing","this","_delay","_frameId","_elapsed","_sleepId","_delayId","_tick","_delayFn","v","start","frameFn","elapsed","tick","restart","stop","sleep","time","end","Value$1","value","precision","transform","_value","default","_precision","Object","keys","forEach","k","toRaw","raw","Transition","cssProperties","apply","_cssProperties","_animations","_apply","update","running","style","name","replace","toLocaleLowerCase","extendOptions","unionCSSProperties","oldCSSProperties","newCSSProperties","finalCSSProperties","_extends","Value","oldCSSName","oldCSSValue","newCSSValue","map","join","union","deltaCSSProperties","startCSSProperties","endCSSProperties","startCSSValue","_endCSSProperties$nam","endCSSValue","restItem","_objectWithoutPropertiesLoose","_excluded","deltaCSSValue","key","deltaValue","delta","deltaCSSNames","remainCSSProperties","_deltaCSSProperties$n","_extendOptions","length","Promise","resolve","before","after","cancel","restOptions","_excluded2","animation","push","remain","progress","next","_progress","thisCSSValue","remainCSSValue","remainValue","index","findIndex","a","splice","count","filter","tempCSSValue","ICSSOptionValue","forwardRef","children","launch","ref","elementRef","useRef","coreRef","current","Core","el","Element","console","warn","e","t","n","r","o","c","test","removeProperty","cssText","setStyle","transitionEnd","then","useImperativeHandle","findDOMElement","getInstance","refFun","useCallback","_ref","element","Component","ReactDOM","findDOMNode","Children","only","cloneElement"],"mappings":"8CAAk4C,MAAMA,EAAE,8ICUn4C,MAMMC,IALO,oBAAXC,aACoB,IAApBA,OAAOC,eAC2B,IAAlCD,OAAOC,SAASC,eAG4BC,EAAMC,gBAAkBD,EAAME,iXCRnF,MAAMC,EAA8B,oBAAXN,OAAyBO,OAASP,OACrDQ,EAAU,CAAC,MAAO,UACxB,IAAIC,EAAMH,EAAKI,sBACXC,EAAML,EAAKM,sBAAwBN,EAAKO,4BAC5C,IAAKJ,IAAQE,EACX,IAAK,IAAIG,EAAI,EAAON,EAAJM,EAAoBA,IAClCL,EAAMH,EAAQE,EAAQM,GAAV,yBACZH,EACEL,EAAQE,EAAQM,GAAV,yBAAuCR,EAAQE,EAAQM,GAAV,+BAGpDL,GAAQE,IACXF,EAAO,WACL,IAAIM,EAAO,EAEX,OAAO,SAAUC,GACf,MAAMC,EAAMC,KAAKD,MACXE,EAAQC,KAAKC,IAAI,EAAG,IAAMJ,EAAMF,IAEtC,OADAA,EAAOE,EAAME,EACNnB,OAAOsB,WAAWN,EAAIG,GAEjC,CATO,GAUPR,EAAM,SAAUY,GACd,OAAOvB,OAAOwB,aAAaD,KAIxB,MAAMb,EAAwBD,EACxBG,EAAuBD,EC1B9Bc,EAAYA,CAACC,EAA8BP,IAC3CA,EAAQ,GACFG,WAAWI,EAAUP,IAE/BO,EAASN,KAAKO,IAAIR,IACX,GAGT,MAAMS,EAWJC,WAAAA,EAAYC,SAAEA,EAAQC,OAAEA,EAAMZ,MAAEA,GAA6B,IAR9Ca,KACfC,OAAiB,EAAGD,KACpBE,SAAmB,EAAGF,KACtBG,SAAmB,EAAGH,KACtBI,SAAmB,EAAGJ,KACtBK,SAAmB,EAAGL,KACtBM,MAAmC,KAAMN,KACzCO,SAAsC,KAEpCP,KAAKF,SAA+B,iBAAbA,GAAyBA,EAAY,EAAQA,EAAJ,EAChEE,KAAKD,OAA2B,mBAAXA,EAAyBS,GAAMA,EAAIT,EACxDC,KAAKb,MAAyB,iBAAVA,EAAqB,EAAIA,CAC/C,CACAsB,KAAAA,CAAMC,GAEJ,IAAKV,KAAKM,QAAUN,KAAKO,SAAU,CACjC,MAAMT,SAAEA,EAAQC,OAAEA,EAAMZ,MAAEA,GAAUa,KACpCA,KAAKO,SAAYI,IAIf,GAHAX,KAAKK,SAAW,EAChBL,KAAKO,SAAW,KAChBP,KAAKC,OAAS,EACVH,EAAW,EAAG,CAChB,MAAMc,EAA4B7B,IAEhC,MAAME,EAAMC,KAAKD,MAEjBe,KAAKG,UAAYlB,EAAMF,EACHe,EAAhBE,KAAKG,UAEPH,KAAKE,SAAWxB,GAAsB,IAAMkC,EAAK3B,KAEjDyB,EAAQX,EAAOC,KAAKG,SAAWL,MAG/BE,KAAKM,MAAQ,KACbN,KAAKE,SAAW,EAChBF,KAAKG,SAAW,EAChBO,EAAQ,GACV,EAEFV,KAAKM,MAAQM,EAEbZ,KAAKG,SAAWQ,GAAW,EAC3BC,EAAK1B,KAAKD,MACZ,MAEEyB,EAAQ,EACV,EAGFV,KAAKC,OAASf,KAAKD,MAEnBe,KAAKK,SAAWZ,EAAUO,KAAKO,SAAUpB,EAC3C,CACF,CACA0B,OAAAA,GACE,IAAIb,KAAKM,OAASN,KAAKO,YAGrBP,KAAKc,OACDd,KAAKM,OAEPN,KAAKM,MAAMpB,KAAKD,OAEde,KAAKO,UAAU,CACjB,MAAMpB,EAAQa,KAAKb,MAAQa,KAAKC,OAEhCD,KAAKC,QAAUf,KAAKD,MAEpBe,KAAKK,SAAWZ,EAAUO,KAAKO,SAAUpB,EAC3C,CAEJ,CACA4B,KAAAA,CAAMC,GACCA,GAAQA,EAAQ,IAIjBhB,KAAKM,OAASN,KAAKO,YAIrBP,KAAKc,OAELd,KAAKI,UAAYd,YAAW,KAC1BU,KAAKI,SAAW,EAEhBJ,KAAKa,SAAS,GACbG,GAEP,CACAF,IAAAA,IACMd,KAAKM,OAASN,KAAKO,YACjBP,KAAKK,WAEPb,aAAaQ,KAAKK,UAClBL,KAAKK,SAAW,EAEhBL,KAAKC,QAAUf,KAAKD,OAElBe,KAAKE,WAEPtB,EAAqBoB,KAAKE,UAC1BF,KAAKE,SAAW,GAEdF,KAAKI,WAEPZ,aAAaQ,KAAKI,UAClBJ,KAAKI,SAAW,GAGtB,CACAa,GAAAA,IACMjB,KAAKM,OAASN,KAAKO,YAGrBP,KAAKc,OACDd,KAAKM,OAEPN,KAAKM,MAAMpB,KAAKD,MAAQe,KAAKG,SAAWH,KAAKF,UAE3CE,KAAKO,UAEPP,KAAKO,SAASP,KAAKF,UAGzB,ECzIa,IAAAoB,EAAA,MAIbrB,WAAAA,CACEsB,EACAC,EACAC,GAEA,MAAMC,EAAUtB,KAAKmB,MAAyB,iBAAVA,EAAqB,CAAEI,QAASJ,GAAUA,EAC9E,GAAyB,iBAAdC,EAAwB,CACjC,MAAMI,EAAwB,CAAA,EAC9BC,OAAOC,KAAKJ,GAAQK,SAASC,IAC3BJ,EAAWI,GAAKR,GAAa,CAAC,IAEhCpB,KAAKoB,UAAYI,CAClB,MAAUJ,IACTpB,KAAKoB,UAAYA,GAEM,mBAAdC,IACTrB,KAAKqB,UAAYA,EAErB,CACAQ,KAAAA,GACE,MAAMC,EAIF,CAAEX,MAAOnB,KAAKmB,OAOlB,OANInB,KAAKoB,YACPU,EAAIV,UAAYpB,KAAKoB,WAEnBpB,KAAKqB,YACPS,EAAIT,UAAYrB,KAAKqB,WAEhBS,CACT,iFClCF,MAAMC,EASJlC,WAAAA,EAAYmC,cAAEA,EAAaC,MAAEA,GAA8B,IAAIjC,KAR/DgC,cAAgC,GAAIhC,KACpCkC,eAAwC,KAAMlC,KAC9CmC,YAIM,GAGJnC,KAAKoC,OAASH,GAAU,MAAQ,GAC5BD,GACFhC,KAAKiC,MAAMD,EAEf,CACAK,MAAAA,IAEOrC,KAAKsC,WAAatC,KAAKkC,iBAC1BlC,KAAKgC,cAAgBhC,KAAKkC,eAC1BlC,KAAKkC,eAAiB,MAGxB,MAAMF,cAAEA,GAAkBhC,KACpBuC,EAAmB,CAAA,EACzBd,OAAOC,KAAKM,GAAeL,SAASa,IAClC,MAAMrB,MAAEA,EAAKE,UAAEA,GAAcW,EAAcQ,GAE3CD,EAAMC,EAAKC,QAAQ,WAAY,OAAOC,qBAAuBrB,EAAUF,EAAM,IAE/EnB,KAAKoC,OAAOG,EACd,CACApB,KAAAA,GAEE,MAAMa,EAAgBhC,KAAKkC,gBAAkBlC,KAAKgC,cAC5Cb,EAAuB,CAAA,EAI7B,OAHAM,OAAOC,KAAKM,GAAeL,SAASC,IAClCT,EAAMS,GAAKI,EAAcJ,GAAGT,KAAK,IAE5BA,CACT,CACAc,KAAAA,CAAMD,EAAqCW,GACpC3C,KAAKkC,iBAERlC,KAAKkC,eAAiBlC,KAAKgC,eAG7B,MAAMY,ECvBH,SACLC,EACAC,GAEA,MAAMC,EAAkCC,EAAA,CAAA,EACnCH,GAEL,GAAIC,aAA4BG,EAAO,CACrC,MAAMC,EAAazB,OAAOC,KAAKmB,GAAkB,GACjD,GAAIK,EAAY,CACd,MAAMC,EAAcN,EAAiBK,GAC/BE,EAAcN,EAAiBjB,QACrCkB,EAAmBG,GAAWF,EACzBG,CAAAA,EAAAA,EACAC,EAAW,CACdjC,MAAK6B,EACAG,CAAAA,EAAAA,EAAYhC,MACZiC,EAAYjC,QAGrB,CACF,MACEM,OAAOC,KAAKoB,GAAkBnB,SAASa,IACrC,MAAMW,EAAcN,EAAiBL,GAC/BY,EAAcN,EAAiBN,GAAMX,QAEzCkB,EAAmBP,GADjBW,EACsBH,EACnBG,CAAAA,EAAAA,EACAC,EAAW,CACdjC,MAAK6B,EACAG,CAAAA,EAAAA,EAAYhC,MACZiC,EAAYjC,SAIK6B,EAAA,CACtB3B,UAAYb,GACViB,OAAOC,KAAKlB,GACT6C,KAAKzB,GAAMpB,EAAEoB,KACb0B,KAAK,KACVlC,UAAW,CAAC,GACTgC,EAEP,IAGJ,OAAOL,CACT,CDxB+BQ,CAAMvD,KAAKkC,eAAgBF,GAEhDwB,ECjDH,SACLC,EACAC,GAEA,MAAMX,EAAqC,CAAA,EAkB3C,OAjBAtB,OAAOC,KAAK+B,GAAoB9B,SAASa,IACvC,MAAMmB,EAAgBF,EAAmBjB,GAAMrB,MAC/CyC,EAAuDF,EAAiBlB,IAAhErB,MAAO0C,EAAWzC,UAAEA,GAAwBwC,EAAVE,EAAQC,EAAAH,EAAAI,GAClD,IAAIC,EAAkC,KACtCxC,OAAOC,KAAKiC,GAAehC,SAASuC,IAClC,MAAMC,EAAaN,EAAYK,GAAOP,EAAcO,GAChD9E,KAAKO,IAAIwE,IAAe/C,EAAU8C,IAAQ,KACvCD,IACHA,EAAgB,CAAA,GAElBA,EAAcC,GAAOC,EACvB,IAEEF,IACFlB,EAAmBP,GAAKQ,EAAA,CAAK7B,MAAO8C,EAAe7C,aAAc0C,GACnE,IAEKf,CACT,CD0B+BqB,CAAMpE,KAAKkC,eAAgBU,GAEtD5C,KAAKkC,eAAiBU,EAEtB,MAAMyB,EAAgB5C,OAAOC,KAAK8B,GAE5Bc,EAAsC,CAAA,EAE5CD,EAAc1C,SAASa,IACrB,MAAA+B,EAA+Bf,EAAmBhB,IAA5CrB,MAAEA,GAAoBoD,EAAVT,EAAQC,EAAAQ,EAAAP,GAC1BM,EAAoB9B,GAAKQ,EAAA,CACvB7B,MAAK6B,EAAA,CAAA,EAAO7B,IACT2C,GAGL9D,KAAKgC,cAAcQ,GAAKQ,EAAA,CAAA,EACnBhD,KAAKgC,cAAcQ,GACnBsB,EACJ,IAGH,MAAMU,EAAkB7B,GAA0C,IAAzB0B,EAAcI,OAAoB9B,EAAL,CAAE,EACxE,OAAO,IAAI+B,SAAwBC,IACjC,MAAMC,OAAEA,EAASA,SAAQC,MAAEA,EAAQA,SAAQC,OAAEA,GAAS,GAAyBN,EAAhBO,EAAWhB,EAAKS,EAAcQ,GACvFC,EAAY,IAAIrF,EAAUmF,GAChC/E,KAAKmC,YAAY+C,KAAK,CAAED,YAAWH,SAAQK,OAAQb,IAEnDW,EAAUxE,OAAO2E,IACf,MAAMC,EAAOT,EAAOQ,EAAUpF,KAAKmB,SACnC,IAAa,IAATkE,EAAgB,CAClB,IAAIC,EAAYF,EACI,iBAATC,IACTC,EAAYD,GAEdhB,EAAc1C,SAASa,IACrB,MAAM+C,EAAevF,KAAKgC,cAAcQ,GAAMrB,MACxC8C,EAAgBT,EAAmBhB,GAAMrB,MACzCqE,EAAiBlB,EAAoB9B,GAAMrB,MACjDM,OAAOC,KAAKuC,GAAetC,SAASuC,IAElC,MAAMuB,EAAcxB,EAAcC,IAAQ,EAAIoB,GAE9CC,EAAarB,IAAQsB,EAAetB,GAAOuB,EAE3CD,EAAetB,GAAOuB,CAAW,GACjC,IAEJzF,KAAKqC,QACP,CAEA,GADAwC,EAAMO,EAAUpF,KAAKmB,SACJ,IAAbiE,EAAgB,CAElB,MAAMM,EAAQ1F,KAAKmC,YAAYwD,WAAWC,GAAMX,IAAcW,EAAEX,aAEjD,IAAXS,GACF1F,KAAKmC,YAAY0D,OAAOH,EAAO,GAEjC1F,KAAKqC,SACLsC,EAAQ3E,KAAKmB,QACf,IACA,GAEN,CACA2D,MAAAA,CAAO7D,GAAe,GAEpB,IAAI6E,EAAQ,EAuBZ,OAtBA9F,KAAKmC,YAAcnC,KAAKmC,YAAY4D,QAAO,EAAGd,YAAWE,SAAQL,aAC/D,GAAIA,EAAQ,CACVG,EAAUhE,EAAM,MAAQ,UACxB6E,GAAS,EAET,MAAM5D,EAAiBlC,KAAKkC,eAY5B,OAXIA,GACFT,OAAOC,KAAKyD,GAAQxD,SAASa,IAC3B,GAAIN,EAAeM,GAAO,CACxB,MAAMgD,EAAiBL,EAAO3C,GAAMrB,MAC9B6E,EAAe9D,EAAeM,GAAMrB,MAC1CM,OAAOC,KAAK8D,GAAgB7D,SAASuC,IACnC8B,EAAa9B,IAAQsB,EAAetB,EAAI,GAE5C,MAGG,CACT,CACA,OAAO,CAAI,IAEblE,KAAKqC,SACEyD,CACT,CACAxD,OAAAA,GACE,OAAmC,IAA5BtC,KAAKmC,YAAYsC,MAC1B,EA6CK,MAAMxB,EAAQgD,EE/JrB,IAAAP,EAAevH,EAAM+H,YACnB,EAAGC,WAAUC,SAAQtB,UAAUuB,KAC7B,MAAMC,EAAanI,EAAMoI,OAAuB,MAC1CC,EAAUrI,EAAMoI,OAAoB,MAE1CxI,GAA0B,KACxByI,EAAQC,QAAU,IAAIC,EAAK,CACzBzE,MAAQM,IACN,MAAMoE,EAAKL,EAAWG,QAChBE,aAAcC,SAClBC,QAAQC,KAAM,4CPhD8/C,SAAWC,EAAEC,GAAG,GAAGD,GAAGC,EAAE,CAAC,IAAIC,EAAE,GAAGxF,OAAOC,KAAKsF,GAAGrF,SAAS7C,IAAI,MAAMoI,EAAl+B,SAAWH,GAAG,OAAOA,EAAEtE,QAAQ,WAAW,OAAOC,mBAAmB,CAAg6ByE,CAAErI,GAAGsI,EAAEJ,EAAElI,GAAG,GAAGsI,GAAG,IAAIA,EAAE,CAAC,MAAML,EAAE,iBAAiBK,GAAG,SAASC,KAAKH,IAAIpJ,EAAEuJ,KAAK,IAAIH,GAAG,KAAK,GAAGD,GAAG,GAAGC,MAAME,IAAIL,IAAI,MAAMA,EAAExE,MAAM+E,eAAeJ,EAAG,IAAGH,EAAExE,MAAMgF,SAASN,CAAC,CAAS,COkDnwDO,CAASb,EAAIpE,EAAM,GAGrB,GACD,IAEHxE,GAA0B,KACxB,GAAIqI,GAAUI,EAAQC,QAAS,CAC7B,MAAMzE,cAAEA,EAAaW,cAAEA,EAAa8E,cAAEA,EAAgBA,UAAarB,EACnEpE,GAAiBwE,EAAQC,QAAQxE,MAAMD,EAAeW,GAAe+E,KAAKD,EAC5E,IACC,CAACrB,IAEJrI,GAA0B,KACxB,GAAI+G,GAAU0B,EAAQC,QAAS,CAC7B,MAAMX,EAAQU,EAAQC,QAAQ3B,QAAkB,IAAXA,GAA0BA,EAAO7D,MACvD,IAAX6D,GACsB,mBAAjBA,EAAOgB,OAAwBhB,EAAOgB,MAAMA,EAEvD,IACC,CAAChB,IAEJ3G,EAAMwJ,oBACJtB,GACA,KAAuB,CACrBuB,eAAgBA,IAAMtB,EAAWG,QACjCoB,YAAaA,IAAMrB,EAAQC,WAE7B,IAWF,MAAMqB,EAAS3J,EAAM4J,aAAaC,IAChC,IAAIC,EAAeD,IAEbA,aAAgBpB,UAAYoB,aAAgB7J,EAAM+J,YACtDD,EAAUE,EAASC,YAAYJ,IAE3BC,aAAmBrB,UACvBqB,EAAU,MAEZ3B,EAAWG,QAAUwB,CAAO,GAC3B,IAEH,OAAK9B,EAKEhI,EAAMkK,SAASC,KACpBnK,EAAMoK,aAAapC,EAAiB,CAClCE,IAAKyB,MANPjB,QAAQC,KAAK,4CACN,KAOR","x_google_ignoreList":[0]}